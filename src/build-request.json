{
  "kind": "build_request",
  "title": "Package the PWA as a fully offline Android APK (bundle website in APK)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-16",
      "text": "Add an Android APK wrapper project that bundles the entire built web app for fully offline loading (no network needed to load the UI), using a WebView/Trusted Web Activity style wrapper that serves the app assets from within the APK.",
      "target": "unknown",
      "source": {
        "messageIds": [
          "msg-user-b"
        ],
        "quotes": [
          "B"
        ]
      },
      "acceptanceCriteria": [
        "A new Android project directory exists in the repo (or an equivalent packaged-wrapper setup) that can be built into an APK without requiring the hosted URL at runtime.",
        "When the APK is installed and the device is in airplane mode, the app launches to the main UI (header, player section, library section) without a blank screen.",
        "User-facing text added for the Android wrapper (if any) is in English."
      ]
    },
    {
      "id": "REQ-17",
      "text": "Update offline behavior so the app provides a clear, English offline mode experience when the network is unavailable: the app shell loads and sample tracks remain playable, while Internet Identity and backend-dependent features gracefully show an offline message rather than failing silently.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-b"
        ],
        "quotes": [
          "B"
        ]
      },
      "acceptanceCriteria": [
        "With the browser offline (or device in airplane mode), the app loads from cache and the bundled sample tracks can be played.",
        "Actions that require backend calls (e.g., favorites/playlists persistence or profile fetching) do not crash the UI; they show an English explanation that the feature requires an internet connection.",
        "No infinite loading spinners occur solely due to offline backend calls; the UI reaches a stable state."
      ]
    },
    {
      "id": "REQ-18",
      "text": "Expand service worker caching to support fully offline app-shell usage by ensuring all required built static assets are cached and served offline (not just the small hard-coded list), while continuing to exclude canister API calls from caching.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-b"
        ],
        "quotes": [
          "B"
        ]
      },
      "acceptanceCriteria": [
        "After a normal online visit, a subsequent offline reload succeeds and loads the full UI without missing JS/CSS assets.",
        "The service worker continues to avoid caching or intercepting requests to icp0.io/ic0.app canister API traffic.",
        "Cache versioning/cleanup still works (old caches removed on activation)."
      ]
    },
    {
      "id": "REQ-19",
      "text": "Add a short English BUILD.md (or equivalent repo documentation) describing how to produce the offline APK from the repository, including prerequisites and the exact build steps/commands.",
      "target": "unknown",
      "source": {
        "messageIds": [
          "msg-user-b"
        ],
        "quotes": [
          "B"
        ]
      },
      "acceptanceCriteria": [
        "Documentation exists in-repo and is written in English.",
        "The doc includes steps to build the web app, bundle it into the Android wrapper, and output an installable APK.",
        "The doc explains expected offline limitations (e.g., backend features require connectivity) so behavior is not ambiguous."
      ]
    }
  ],
  "constraints": [
    "Use English for any user-facing text added or modified.",
    "Do not edit files under frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, or any files under frontend/src/components/ui.",
    "Backend must remain a single Motoko actor in backend/main.mo; only add migration code if a state upgrade is required."
  ],
  "nonGoals": [
    "Adding third-party authentication providers (only Internet Identity is supported).",
    "Implementing true offline persistence/sync for user favorites/playlists in the backend (backend requires network access).",
    "Introducing external databases, cloud services, or non-Motoko backend services."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}